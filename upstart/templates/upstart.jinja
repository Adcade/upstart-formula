# {{ name }} Upstart Script generated by Salt. {{ name }}
start on (local-filesystems
    and net-device-up IFACE!=lo)
stop on shutdown

{% set respawn_timeout = 20 %}
{% set respawn_attempts = 2 %}


respawn
respawn limit {{ respawn_attempts }} {{ respawn_timeout }}
oom never

pre-start script
  if [ {{ log_file }} -ne "/dev/null" ]; then
    rm -f {{ log_file }}
    touch {{ log_file }}
    chown {{ service_account }}:{{ service_account }} {{ log_file }}
  fi
  {% if env is defined %}
  {% for key, value in env.items() -%}
    export {{ key }}={{ value }}
  {%- endfor %}
  {% endif %}
end script

script
  {% if app_dir is defined -%}
    chdir {{ app_dir }}
  {%- endif %}
  exec su -s /bin/sh -c "{{ exec }}" {{ service_account }} > {{ log_file }} 2>&1
end script

post-stop script
end script
